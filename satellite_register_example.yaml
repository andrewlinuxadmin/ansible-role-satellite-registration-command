---
- name: Get Satellite Registration command
  hosts: localhost
  gather_facts: false
  vars:
    ansible_become: "no"
    ansible_connection: "local"
  roles:
    - role: satellite_registration_command
      vars:
        satellite_registration_command_url: "https://satellite.example.com"
        satellite_registration_command_username: "username"
        satellite_registration_command_password: "password_or_token"
        satellite_registration_command_organization: "org1"
        satellite_registration_command_location: "loc1"
        satellite_registration_command_hostgroup: "HG-Generic"
        satellite_registration_command_activation_keys:
          - AK-VDC
          - AK-RHEL8-EPEL8

- name: Register hosts on the Satellite using the command generated by the Registration Command
  hosts: all
  gather_facts: false
  vars:
    ansible_become: "yes"
  tasks:
    - name: Execute Satellite registration command
      shell: "export LANG=en && {{ hostvars['localhost']['satellite_registration_command'] }}"
      when: hostvars['localhost']['satellite_registration_command'] is defined
      register: satellite_registration_command_execution_result

    - name: Show output
      debug:
        var: satellite_registration_command_execution_result
